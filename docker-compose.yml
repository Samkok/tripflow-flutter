version: '3.8'

services:
  # Development environment with hot reload
  dev:
    build:
      context: .
      target: dev
    ports:
      - "3000:3000"
    volumes:
      - .:/app
      - /app/build
      - /app/.dart_tool
    environment:
      - FLUTTER_WEB_AUTO_DETECT=true
    stdin_open: true
    tty: true

  # Web production server
  web:
    build:
      context: .
      target: production-web
    ports:
      - "8080:80"
    environment:
      - NGINX_HOST=localhost
      - NGINX_PORT=80

  # Run tests
  test:
    build:
      context: .
      target: test
    volumes:
      - .:/app
      - /app/build
      - /app/.dart_tool

  # Run linting
  lint:
    build:
      context: .
      target: lint
    volumes:
      - .:/app
      - /app/build
      - /app/.dart_tool

  # Build Android APK
  build-android:
    build:
      context: .
      target: build-android
    volumes:
      - ./build:/app/build
    command: echo "APK built successfully"

  # Build Android App Bundle
  build-appbundle:
    build:
      context: .
      target: build-appbundle
    volumes:
      - ./build:/app/build
    command: echo "App Bundle built successfully"

  # Build Web App
  build-web:
    build:
      context: .
      target: build-web
    volumes:
      - ./build:/app/build
    command: echo "Web app built successfully"
